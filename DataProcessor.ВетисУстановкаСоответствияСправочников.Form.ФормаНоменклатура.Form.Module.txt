
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	ВетисКонтрагент = ВетисПредопределенные.Получить("ВетисКонтрагент");
	
	ТипПродукции = ПредопределенноеЗначение("Перечисление.ВетисProductType.МясоИМясопродукты");
	
КонецПроцедуры

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	
КонецПроцедуры

&НаКлиенте
Процедура ВетисНоменклатураЗаполнить(Команда)
	
	ВетисНоменклатураЗаполнитьСервер();
	
КонецПроцедуры

&НаСервере
Процедура ВетисНоменклатураЗаполнитьСервер()
	
	Перем _Product, _subProduct, _параметрыP;
	
	_ТипПродукции = ВетисArgusProductionСлой1с.ProductType(ТипПродукции);
	
	Объект.ВетисНоменклатура.Очистить();
	
	Пока Истина Цикл
		
		Если НЕ ВетисArgusProduction.GetProductByTypeListСледующий(_ТипПродукции, _Product, _параметрыP) Тогда
			Прервать;
		КонецЕсли;
		
		_параметрыS = Неопределено;
		Пока Истина Цикл
			
			Если НЕ ВетисArgusProduction.GetSubProductByProductListСледующий(_Product.guid, _subProduct, _параметрыS) Тогда
				Прервать;
			КонецЕсли;
			
			ТаблицаСтрока = Объект.ВетисНоменклатура.Добавить();
			ТаблицаСтрока.Наименование = _subProduct.name;
			ТаблицаСтрока.UUID         = _subProduct.uuid;
			ТаблицаСтрока.Код          = _subProduct.code;
			ТаблицаСтрока.Статус       = _subProduct.status;
			ТаблицаСтрока.GUID         = _subProduct.guid;
			ТаблицаСтрока.РодительGUID = _Product.guid;
			
		КонецЦикла;
		
	КонецЦикла;
	
	Объект.ВетисНоменклатура.Сортировать("Наименование");
		
КонецПроцедуры


&НаКлиенте
Процедура СоздатьСвязь(Команда)
	
	СоздатьСвязьСервер();
	
	Элементы.СправочникСписок.Обновить();
	
КонецПроцедуры

&НаСервере
Процедура СоздатьСвязьСервер() Экспорт
	
	ТекДанные = Объект.ВетисНоменклатура.НайтиПоИдентификатору(Элементы.ВетисНоменклатура.ТекущаяСтрока);
	
	_ТипПродукции = Перечисления.ВетисProductType.Индекс(ТипПродукции) + 1;
	
	Если Элементы.СправочникСписок.ВыделенныеСтроки.Количество() > 0 Тогда
		Для Каждого ТекДанные1с из Элементы.СправочникСписок.ВыделенныеСтроки Цикл
			
		КонецЦикла;
	Иначе
		ТекДанные1с = Элементы.СправочникСписок.ТекущиеДанные;
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура УдалитьСвязь(Команда)
	
	УдалитьСвязьСервер();
	
	Элементы.СправочникСписок.Обновить();
	
КонецПроцедуры

&НаСервере
Процедура УдалитьСвязьСервер()
	
	Если Элементы.СправочникСписок.ВыделенныеСтроки.Количество() > 0 Тогда
		Для Каждого ТекДанные из Элементы.СправочникСписок.ВыделенныеСтроки Цикл
			
		КонецЦикла;
	Иначе
		ТекДанные = Элементы.СправочникСписок.ТекущиеДанные;
		
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ВетисНоменклатураВыбор(Элемент, ВыбраннаяСтрока, Поле, СтандартнаяОбработка)
	
	ТекДанные = Элементы.ВетисНоменклатура.ТекущиеДанные;
	
	Если ТекДанные = Неопределено Тогда Возврат; КонецЕсли;
	
	ВетисОбщегоНазначения.ДобавитьОтбор(СправочникСписок.Отбор, "Наименование", ТекДанные.Наименование);
	
КонецПроцедуры
