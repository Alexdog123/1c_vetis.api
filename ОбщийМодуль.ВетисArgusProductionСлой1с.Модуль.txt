
Функция ProductType(value, ПоУмолчанию = Неопределено) Экспорт
	
	Если ТипЗнч(value) = Тип("СправочникСсылка.НоменклатурныеГруппы")
		ИЛИ ТипЗнч(value) = Тип("СправочникСсылка.Номенклатура") Тогда
		guid = SubProduct(value, ПоУмолчанию);
		SubProduct = ВетисArgusProduction.GetSubProductByGuid(guid);
		Product = ВетисArgusProduction.GetProductByGuid(SubProduct.productGuid);
		Возврат Product.productType;
	ИначеЕсли ТипЗнч(value) = Тип("ПеречислениеСсылка.ВетисProductType") Тогда
		Если      value = ПредопределенноеЗначение("Перечисление.ВетисProductType.МясоИМясопродукты") Тогда
			Возврат 1;
		ИначеЕсли value = ПредопределенноеЗначение("Перечисление.ВетисProductType.КормаИКормовыеДобавки") Тогда
			Возврат 2;
		ИначеЕсли value = ПредопределенноеЗначение("Перечисление.ВетисProductType.ЖивыеЖивотные") Тогда
			Возврат 3;
		ИначеЕсли value = ПредопределенноеЗначение("Перечисление.ВетисProductType.ЛекарственныеСредства") Тогда
			Возврат 4;
		ИначеЕсли value = ПредопределенноеЗначение("Перечисление.ВетисProductType.ПищевыеПродукты") Тогда
			Возврат 5;
		ИначеЕсли value = ПредопределенноеЗначение("Перечисление.ВетисProductType.НепищевыеПродуктыИДругое") Тогда
			Возврат 6;
		ИначеЕсли value = ПредопределенноеЗначение("Перечисление.ВетисProductType.РыбаИМорепродукты") Тогда
			Возврат 7;
		ИначеЕсли value = ПредопределенноеЗначение("Перечисление.ВетисProductType.ПродукцияНеТребующаяРазрешения") Тогда
			Возврат 8;
		Иначе
			Возврат ПоУмолчанию;
		КонецЕсли;
	Иначе
		Если      value = "1" Тогда
			Возврат ПредопределенноеЗначение("Перечисление.ВетисProductType.МясоИМясопродукты");
		ИначеЕсли value = "2" Тогда
			Возврат ПредопределенноеЗначение("Перечисление.ВетисProductType.КормаИКормовыеДобавки");
		ИначеЕсли value = "3" Тогда
			Возврат ПредопределенноеЗначение("Перечисление.ВетисProductType.ЖивыеЖивотные");
		ИначеЕсли value = "4" Тогда
			Возврат ПредопределенноеЗначение("Перечисление.ВетисProductType.ЛекарственныеСредства");
		ИначеЕсли value = "5" Тогда
			Возврат ПредопределенноеЗначение("Перечисление.ВетисProductType.ПищевыеПродукты");
		ИначеЕсли value = "6" Тогда
			Возврат ПредопределенноеЗначение("Перечисление.ВетисProductType.НепищевыеПродуктыИДругое");
		ИначеЕсли value = "7" Тогда
			Возврат ПредопределенноеЗначение("Перечисление.ВетисProductType.РыбаИМорепродукты");
		ИначеЕсли value = "8" Тогда
			Возврат ПредопределенноеЗначение("Перечисление.ВетисProductType.ПродукцияНеТребующаяРазрешения");
		Иначе
			Возврат ПоУмолчанию;
		КонецЕсли;
	КонецЕсли;
	
КонецФункции

Функция SubProductНоменклатура(пСсылка, ПоУмолчанию = Неопределено) Экспорт
	
	Если ТипЗнч(пСсылка) = Тип("СправочникСсылка.Номенклатура") Тогда
		Возврат ВетисСоответствие.ПолучитьGuid(пСсылка, ПоУмолчанию);
	ИначеЕсли ТипЗнч(пСсылка) = Тип("ОбъектXDTO") ИЛИ ТипЗнч(пСсылка) = Тип("Структура") Тогда
		Возврат ВетисСоответствие.ПолучитьСсылку(пСсылка.guid, "Справочник.Номенклатура", ПоУмолчанию);
	Иначе
		Возврат ВетисСоответствие.ПолучитьСсылку(пСсылка, "Справочник.Номенклатура", ПоУмолчанию);
	КонецЕсли;
	
КонецФункции

Функция SubProduct(пСсылка, ПоУмолчанию = Неопределено) Экспорт
	
	Если ТипЗнч(пСсылка) = Тип("СправочникСсылка.НоменклатурныеГруппы") Тогда
		Возврат ВетисСоответствие.ПолучитьGuid(пСсылка, ПоУмолчанию);
	ИначеЕсли ТипЗнч(пСсылка) = Тип("СправочникСсылка.Номенклатура") Тогда
		Возврат ВетисСоответствие.ПолучитьGuid(пСсылка.НоменклатурнаяГруппа, ПоУмолчанию);
	ИначеЕсли ТипЗнч(пСсылка) = Тип("ОбъектXDTO") ИЛИ ТипЗнч(пСсылка) = Тип("Структура") Тогда
		Возврат ВетисСоответствие.ПолучитьСсылку(пСсылка.guid, "Справочник.НоменклатурныеГруппы", ПоУмолчанию);
	Иначе
		Возврат ВетисСоответствие.ПолучитьСсылку(пСсылка, "Справочник.НоменклатурныеГруппы", ПоУмолчанию);
	КонецЕсли;
	
КонецФункции

Функция Product(пСсылка, ПоУмолчанию = Неопределено) Экспорт
	
	Если ТипЗнч(пСсылка) = Тип("СправочникСсылка.НоменклатурныеГруппы") Тогда
		guid = SubProduct(пСсылка, ПоУмолчанию);
		SubProduct = ВетисArgusProduction.GetSubProductByGuid(guid);
		Возврат SubProduct.productGuid;
		//Возврат ВетисArgusProduction.GetSubProductByGuid(SubProduct(пСсылка, ПоУмолчанию)).productGuid;
	Иначе
		//Product не хранится, обратная конверсия невозможна
		Возврат Неопределено;
	КонецЕсли;
	
КонецФункции

