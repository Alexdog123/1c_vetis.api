
&НаКлиенте
Процедура ПодборПартий(Команда)
	
	оо = Новый ОписаниеОповещения("ПодборПартийОбработкаОповещения", ЭтаФорма);
	
	ОткрытьФорму("Документ.ВетисТранспортнаяПартия.Форма.ФормаПодборПартий", Новый Структура("РежимВыбора, Предприятие", Истина, Объект.ОтправительПредприятие), ЭтаФорма,,,, оо);
	
КонецПроцедуры

&НаКлиенте
Процедура ПодборПартийОбработкаОповещения(Результат, Параметр) Экспорт
	
	_ТекущиеДанные = Элементы.Товары.ТекущиеДанные;
	
	_Строки = Объект.Партии.НайтиСтроки(Новый Структура("guid", Результат.guid));
	
	Если _Строки.Количество() = 0 Тогда
		_Строка = Объект.Партии.Добавить();
	Иначе
		_Строка = _Строки[0];
	КонецЕсли;
	
	_Строка.КлючСвязи = _ТекущиеДанные.КлючСтроки;
	_Строка.Номенклатура = _ТекущиеДанные.Номенклатура;
	
	_Строка.guid = Результат.guid;
	_Строка.Дата = Результат.Дата;
	
	_Строка.Количество = Результат.Количество;
	_Строка.КоличествоМест = Результат.КоличествоМест;
	
КонецПроцедуры

&НаСервере
Процедура ЗаполнитьНаСервере()
	
	_Объект = РеквизитФормыВЗначение("Объект");
	
	_Объект.Заполнить(Объект.ДокументОснование);
	
	ЗначениеВРеквизитФормы(_Объект, "Объект");
	
КонецПроцедуры

&НаКлиенте
Процедура Заполнить(Команда)
	
	ЗаполнитьНаСервере();
	
КонецПроцедуры

&НаКлиенте
Процедура ДокументОснованиеПриИзменении(Элемент)
	
	ЗаполнитьНаСервере();
	
КонецПроцедуры

&НаКлиенте
Процедура ЗаполнитьТовары(Команда)
	
	//Для каждого _Строка Из Объект.ДокументОснование.Товары Цикл
	//	
	//КонецЦикла;
	
КонецПроцедуры

&НаКлиенте
Процедура ТоварыПриАктивизацииСтроки(Элемент)
	
	Если Элементы.Товары.ТекущиеДанные = Неопределено Тогда
		Возврат;
	КонецЕсли;
	
	Элементы.Партии.ОтборСтрок = Новый ФиксированнаяСтруктура("КлючСвязи", Элементы.Товары.ТекущиеДанные.КлючСтроки);
	
КонецПроцедуры

&НаКлиенте
Процедура КомандаОтправить(Команда)
	
	Если НЕ Объект.Проведен Тогда
		Возврат;
	КонецЕсли;
	
	КомандаОтправитьНаСервере();
	
КонецПроцедуры

&НаСервере
Процедура КомандаОтправитьНаСервере()
	
	Для каждого _СтрокаСЖ Из Объект.СкладскойЖурнал Цикл
		
		_ПартииСтроки = Объект.Партии.НайтиСтроки(Новый Структура("КлючСвязи", _СтрокаСЖ.КлючСтроки));
		
		ВетисMercuryApplicationsСлой1с.TransportOperation(_СтрокаСЖ, _ПартииСтроки);
		
	КонецЦикла;
	
КонецПроцедуры
