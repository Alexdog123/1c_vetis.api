
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
КонецПроцедуры


&НаКлиенте
Процедура ТоварыВыбор(Элемент, ВыбраннаяСтрока, Поле, СтандартнаяОбработка)
	
	Если Поле.Имя = "ТоварыВозвратныйВСД" Тогда
		//ОткрытьЗначение(Элементы.Товары.ТекущиеДанные.ВозвратныйВСД);
	ИначеЕсли Поле.Имя = "ТоварыВСД" И ЗначениеЗаполнено(Элементы.Товары.ТекущиеДанные.guid) Тогда
		ОткрытьЗначение(Элементы.Товары.ТекущиеДанные.ВСД);
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ТоварыПередНачаломДобавления(Элемент, Отказ, Копирование, Родитель, Группа, Параметр)
	
	Отказ = Копирование;
	
КонецПроцедуры

&НаКлиенте
Процедура ТоварыПередУдалением(Элемент, Отказ)
	
	Отказ = ЗначениеЗаполнено(Элемент.ТекущиеДанные.guid);
	
КонецПроцедуры

&НаКлиенте
Процедура ТоварыПриАктивизацииСтроки(Элемент)
	
	Отправитель = Неопределено;
	Получатель = Неопределено;
	ОтправительПредприятие = Неопределено;
	ПолучательПредприятие = Неопределено;
	Количество = Неопределено;
	КоличествоМест = Неопределено;
	
	Если Элементы.Товары.ТекущиеДанные = Неопределено Тогда
		Возврат;
	КонецЕсли;
	
	Если НЕ ЗначениеЗаполнено(Элементы.Товары.ТекущиеДанные.ВСД) Тогда
		Возврат;
	КонецЕсли;
	
	ЗаполнитьФормуПоВСД(Элементы.Товары.ТекущиеДанные.ВСД);
	
КонецПроцедуры

&НаКлиенте
Процедура ТоварыВСДПриИзменении(Элемент = Неопределено)
	
	Если НЕ ЗначениеЗаполнено(Элементы.Товары.ТекущиеДанные.ВСД) Тогда
		Возврат;
	КонецЕсли;
	
	ЗаполнитьСтрокуПоВСД(Элементы.Товары.ТекущаяСтрока, Элементы.Товары.ТекущиеДанные.ВСД);
	
КонецПроцедуры

&НаКлиенте
Процедура ТоварыВСДНачалоВыбора(Элемент, ДанныеВыбора, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	
	_Статус = Новый СписокЗначений;
	_Статус.Добавить(ПредопределенноеЗначение("Перечисление.ВетисVetDocumentStatus.ПустаяСсылка"));
	_Статус.Добавить(ПредопределенноеЗначение("Перечисление.ВетисVetDocumentStatus.Оформлен"));
	
	_Тип = Новый СписокЗначений;
	_Тип.Добавить(ПредопределенноеЗначение("Перечисление.ВетисVetDocumentType.ПустаяСсылка"));
	_Тип.Добавить(ПредопределенноеЗначение("Перечисление.ВетисVetDocumentType.Входящий"));
	_Тип.Добавить(ПредопределенноеЗначение("Перечисление.ВетисVetDocumentType.Транспортный"));
	
	_Параметры = Новый Структура("Проведен, Статус, Тип", Истина, _Статус, _Тип);
	
	_оо = Новый ОписаниеОповещения("ТоварыВСДНачалоВыбораОбработкаОповещения", ЭтаФорма);
	
	ОткрытьФорму("Документ.ВетисВетеринарноСопроводительныйДокумент.ФормаВыбора", _Параметры,,,,, _оо);
	
КонецПроцедуры

&НаКлиенте
Процедура ТоварыВСДНачалоВыбораОбработкаОповещения(Результат, Параметр) Экспорт
	
	Элементы.Товары.ТекущиеДанные.ВСД = Результат;
	
	ТоварыВСДПриИзменении();
	
КонецПроцедуры


&НаКлиенте
Процедура СоставитьАктНесоответствияПриИзменении(Элемент)
	
	Элементы.ГруппаАктНесоответствияКолонка.Доступность = Объект.СоставитьАктНесоответствия;
	
КонецПроцедуры


&НаКлиенте
Процедура КомандаОтправить(Команда)
	
	Если НЕ Объект.Проведен Тогда
		Возврат;
	КонецЕсли;
	
	_Индекс = 0;
	
	Для _Индекс = 0 По Объект.Товары.Количество()-1 Цикл
		
		Если ЗначениеЗаполнено(Объект.Товары[_Индекс].guid) Тогда
			Продолжить;
		КонецЕсли;
		
		КомандаОтправитьСервер(_Индекс);
		
	КонецЦикла;
	
КонецПроцедуры

&НаСервере
Процедура КомандаОтправитьСервер(пНомерСтроки)
	
	_Отказ = Ложь;
	
	_СтрокаСЖ = Объект.Товары.Получить(пНомерСтроки);
	
	ВетисMercuryApplicationsСлой1с.IncomingOperation(_СтрокаСЖ, _СтрокаСЖ.ВСД, Объект.Дата, _Отказ);
	
	Если НЕ _Отказ = Ложь Тогда
		Модифицированность = Истина;
	КонецЕсли;
	
КонецПроцедуры


&НаКлиенте
Процедура ПредприятиеОбработкаОповещения(пЗначение, пПараметр) Экспорт
	
	Если НЕ пЗначение = Неопределено Тогда
		Модифицированность = Истина;
		Выполнить пПараметр + " = пЗначение;";
	КонецЕсли;
	
КонецПроцедуры

&НаСервере
Процедура ЗаполнитьФормуПоВСД(пВСД)
	
	ЗаполнитьЗначенияСвойств(ЭтаФорма, пВСД, "Отправитель, ОтправительПредприятие, Получатель, ПолучательПредприятие");
	
	_всдСтрокаСЖ = пВСД.Товары[0];
	
	Количество = _всдСтрокаСЖ.Количество;
	
	КоличествоМест = _всдСтрокаСЖ.КоличествоМест;
	
КонецПроцедуры

&НаСервере
Процедура ЗаполнитьСтрокуПоВСД(пСтрокаСЖ, пВСД)
	
	_СтрокаСЖ = Объект.Товары.НайтиПоИдентификатору(пСтрокаСЖ);
	
	_всдСтрокаСЖ = пВСД.Товары[0];
	
	_СтрокаСЖ.НоменклатурнаяГруппа = _всдСтрокаСЖ.НоменклатурнаяГруппа;
	_СтрокаСЖ.Номенклатура   = _всдСтрокаСЖ.Номенклатура;
	
	_СтрокаСЖ.Количество     = _всдСтрокаСЖ.Количество;
	_СтрокаСЖ.КоличествоМест = _всдСтрокаСЖ.КоличествоМест;
	
	_СтрокаСЖ.ЕдиницаИзмерения = _всдСтрокаСЖ.ЕдиницаИзмерения;
	_СтрокаСЖ.Упаковка         = _всдСтрокаСЖ.Упаковка;
	
	_СтрокаСЖ.ProductItemGuid = _всдСтрокаСЖ.ProductItemGuid;
	_СтрокаСЖ.SubProductGuid  = _всдСтрокаСЖ.SubProductGuid;
	
КонецПроцедуры
