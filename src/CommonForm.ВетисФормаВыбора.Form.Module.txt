
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Если Параметры.Свойство("Имя") Тогда
		_Имя = Параметры.Имя;
	Иначе
		_Имя = "BusinessEntity";
	КонецЕсли;
	
	_Имя = Вычислить("ВетисИмяСправочника."+_Имя+"()");
	
	Список.ОсновнаяТаблица = "Справочник."+_Имя;
	
	Если Параметры.Свойство("Запрос") Тогда
		Список.ТекстЗапроса = Параметры.Запрос;
	Иначе
		Список.ТекстЗапроса = ТекстЗапроса(_Имя);
	КонецЕсли;
	
	Если Параметры.Свойство("Ключ") Тогда
		
		Элементы.Список.ТекущаяСтрока = Параметры.Ключ;
		
	КонецЕсли;
	
	Элементы.Список.ПодчиненныеЭлементы.Владелец.Видимость = Метаданные.Справочники[_Имя].Владельцы.Количество() > 0;
	
	Если Параметры.Свойство("Владелец") Тогда
		Элементы.Список.ПодчиненныеЭлементы.Владелец.Видимость = Ложь;
		Если ТипЗнч(Параметры.Владелец) = Тип("СписокЗначений") Тогда
			ВетисОбщегоНазначенияКлиентСервер.ДобавитьОтбор(Список.Отбор, "Владелец", Параметры.Владелец, "ВСписке");
		Иначе
			ВетисОбщегоНазначенияКлиентСервер.ДобавитьОтбор(Список.Отбор, "Владелец", Параметры.Владелец);
		КонецЕсли;
	КонецЕсли;
	
КонецПроцедуры

Функция ТекстЗапроса(пИмя)
	
	_Текст =
	"ВЫБРАТЬ
	|	_Таблица.Ссылка КАК Ссылка,
	|	_Таблица.Код КАК Код,
	|	_Таблица.Наименование КАК Наименование,
	|	ВЫБОР
	|		КОГДА _Ветис.Ссылка ЕСТЬ NULL
	|			ТОГДА ЛОЖЬ
	|		ИНАЧЕ ИСТИНА
	|	КОНЕЦ КАК Подсветка
	|ИЗ
	|	Справочник."+пИмя+" КАК _Таблица
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ВетисСоответствие КАК _Ветис
	|		ПО _Таблица.Ссылка = _Ветис.Ссылка
	|ГДЕ
	|	ИСТИНА
	|	И НЕ _Таблица.ПометкаУдаления
	|//ои	И НЕ _Таблица.ЭтоГруппа";
	
	Если Метаданные.Справочники[пИмя].Иерархический Тогда
		_Текст = СтрЗаменить(_Текст, "//ои", "");
	КонецЕсли;
	
	Возврат _Текст;
	
КонецФункции
