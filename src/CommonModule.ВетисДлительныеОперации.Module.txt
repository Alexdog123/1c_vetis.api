
Процедура ВетисОчередьЗапросов() Экспорт
	
	Запрос = Новый Запрос;
	Запрос.Текст =
	"ВЫБРАТЬ ПЕРВЫЕ 1
	|	_Таблица.ХС,
	|	_Таблица.issuerId,
	|	_Таблица.Операция,
	|	_Таблица.TransactionId,
	|	_Таблица.ApplicationId,
	|	_Таблица.ТекстЗапроса,
	|	_Таблица.ТекстОтвета,
	|	_Таблица.Ошибка,
	|	_Таблица.Статус
	|ИЗ
	|	РегистрСведений.ВетисОчередьЗапросов КАК _Таблица
	|ГДЕ
	|	_Таблица.Статус В (ЗНАЧЕНИЕ(Перечисление.ВетисСтатусЗапроса.ПустаяСсылка), ЗНАЧЕНИЕ(Перечисление.ВетисСтатусЗапроса.IN_PROCESS))";
	
	Результат = Запрос.Выполнить();
	Выборка = Результат.Выбрать();
	
	Пока Выборка.Следующий() Цикл
		Если ЗначениеЗаполнено(Выборка.ТекстЗапроса) Тогда
			_Ответ = Ветис.ОтправитьЗапрос(Строка(Выборка.Операция) + "Request", Выборка.ТекстЗапроса, Выборка.issuerId);
		Иначе
			_Ответ = Ветис.ПолучитьОтвет(Строка(Выборка.Операция) + "Request", Выборка.ApplicationId, Выборка.issuerId);
		КонецЕсли;
	КонецЦикла;
	
	_мз = РегистрыСведений.ВетисОчередьЗапросов.СоздатьМенеджерЗаписи();
	
	ЗаполнитьЗначенияСвойств(_мз, Выборка);
	
	_Фабрика = Ветис.ФабрикаОбщая();
	
	_Envelope = ВетисОбщегоНазначения.Десериализовать(_Фабрика, _Ответ.Текст, _Envelope.Тип());
	
	_receiveResponse = ВетисSoapEnvelope.Извлечь(_Envelope).receiveApplicationResultResponse;
	
	Если _receiveResponse.Application.Status = ВетисКонстанты.Status_ACCEPTED() Тогда
		_мз.Статус = Перечисления.ВетисСтатусЗапроса.ACCEPTED;
	ИначеЕсли _receiveResponse.Application.Status = ВетисКонстанты.Status_COMPLETED() Тогда
		_мз.Статус = Перечисления.ВетисСтатусЗапроса.COMPLETED;
	ИначеЕсли _receiveResponse.Application.Status = ВетисКонстанты.Status_IN_PROCESS() Тогда
		_мз.Статус = Перечисления.ВетисСтатусЗапроса.IN_PROCESS;
	ИначеЕсли _receiveResponse.Application.Status = ВетисКонстанты.Status_REJECTED() Тогда
		_мз.Статус = Перечисления.ВетисСтатусЗапроса.REJECTED;
	Иначе
		_мз.Статус = Перечисления.ВетисСтатусЗапроса.ПустаяСсылка();
	КонецЕсли;
	
	//Если _receiveResponse.Application.Status = ВетисКонстанты.Status_IN_PROCESS() Тогда
	//	Возврат Новый Структура("Отказ, Ответ, status", Истина, "", _receiveResponse.Application.status);
	//Иначе
	//	Если НЕ _receiveResponse.Application.status = ВетисКонстанты.Status_COMPLETED() Тогда
	//		Возврат Новый Структура("Отказ, Ответ, status", Истина, ПолучитьТекстОшибки(_receiveResponse.Application.errors), _receiveResponse.Application.status);
	//	Иначе
	//		Возврат Новый Структура("Отказ, Ответ, status", Ложь, _Ответ.ПолучитьТелоКакСтроку("UTF-8"), _receiveResponse.Application.status);
	//	КонецЕсли;
	//КонецЕсли;
	
КонецПроцедуры
