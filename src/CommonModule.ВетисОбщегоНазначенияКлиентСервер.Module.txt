
Функция ДобавитьОтбор(пОтбор, пПоле, пЗначение = Неопределено, пВидСравнения = Неопределено, пИспользование = Неопределено) Экспорт
	
	_Поле = Новый ПолеКомпоновкиДанных(пПоле);
	
	_Элементы = ОтборПолучитьЭлементы(пОтбор);
	
	_Найден = Ложь;
	
	Для каждого _Элемент Из _Элементы Цикл
		Если _Элемент.ЛевоеЗначение = _Поле Тогда
			_Найден = Истина;
			Прервать;
		КонецЕсли;
	КонецЦикла;
	
	Если _Найден = Ложь Тогда
		_Элемент = _Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
	КонецЕсли;
	
	_Элемент.Использование = ?(пИспользование = Неопределено, Истина, пИспользование);
	
	Если НЕ пВидСравнения = Неопределено Тогда
		_Элемент.ВидСравнения = ПредопределенноеЗначение("ВидСравненияКомпоновкиДанных."+пВидСравнения);
	КонецЕсли;
	
	_Элемент.ЛевоеЗначение = _Поле;
	
	_Элемент.ПравоеЗначение = пЗначение;
	
КонецФункции

Функция ОтборПолучитьЭлементы(Источник) Экспорт
	
	Результат = Неопределено;
	
	Если ТипЗнч(Источник) = Тип("КомпоновщикНастроекКомпоновкиДанных") Тогда
		Результат = Источник.Настройки.Отбор.Элементы;
		
	ИначеЕсли ТипЗнч(Источник) = Тип("НастройкиКомпоновкиДанных") Тогда
		Результат = Источник.Отбор.Элементы;
		
	ИначеЕсли ТипЗнч(Источник) = Тип("ОтборКомпоновкиДанных") Тогда
		Результат = Источник.Элементы;
		
	ИначеЕсли ТипЗнч(Источник) = Тип("КоллекцияЭлементовОтбораКомпоновкиДанных") Тогда
		Результат = Источник;
		
	КонецЕсли;
	
	Возврат Результат;
	
КонецФункции
