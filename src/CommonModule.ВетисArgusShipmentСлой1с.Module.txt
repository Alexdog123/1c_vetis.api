
Функция TransportType(value) Экспорт
	
	Если ТипЗнч(value) = Тип("ПеречислениеСсылка.ВетисTransportType") Тогда
		Если      value = ПредопределенноеЗначение("Перечисление.ВетисTransportType.Автомобильный") Тогда
			Возврат ВетисКонстанты.TransportType_Автомобильный();
		ИначеЕсли value = ПредопределенноеЗначение("Перечисление.ВетисTransportType.Железнодорожный") Тогда
			Возврат ВетисКонстанты.TransportType_Железнодорожный();
		ИначеЕсли value = ПредопределенноеЗначение("Перечисление.ВетисTransportType.Авиатранспорт") Тогда
			Возврат ВетисКонстанты.TransportType_Авиатранспортный();
		ИначеЕсли value = ПредопределенноеЗначение("Перечисление.ВетисTransportType.МорскойКонтейнер") Тогда
			Возврат ВетисКонстанты.TransportType_МорскойКонтейнер();
		ИначеЕсли value = ПредопределенноеЗначение("Перечисление.ВетисTransportType.МорскойТрюм") Тогда
			Возврат ВетисКонстанты.TransportType_МорскойТрюм();
		Иначе
			Возврат ВетисКонстанты.TransportType_Автомобильный();
		КонецЕсли;
	Иначе
		Если      value = ВетисКонстанты.TransportType_Автомобильный() Тогда
			Возврат ПредопределенноеЗначение("Перечисление.ВетисTransportType.Автомобильный");
		ИначеЕсли value = ВетисКонстанты.TransportType_Железнодорожный() Тогда
			Возврат ПредопределенноеЗначение("Перечисление.ВетисTransportType.Железнодорожный");
		ИначеЕсли value = ВетисКонстанты.TransportType_Авиатранспортный() Тогда
			Возврат ПредопределенноеЗначение("Перечисление.ВетисTransportType.Авиатранспорт");
		ИначеЕсли value = ВетисКонстанты.TransportType_МорскойКонтейнер() Тогда
			Возврат ПредопределенноеЗначение("Перечисление.ВетисTransportType.МорскойКонтейнер");
		ИначеЕсли value = ВетисКонстанты.TransportType_МорскойТрюм() Тогда
			Возврат ПредопределенноеЗначение("Перечисление.ВетисTransportType.МорскойТрюм");
		Иначе
			Возврат ПредопределенноеЗначение("Перечисление.ВетисTransportType.Автомобильный");
		КонецЕсли;
	КонецЕсли;
	
КонецФункции

Функция TransportationStorageType(value) Экспорт
	
	Если ТипЗнч(value) = Тип("ПеречислениеСсылка.ВетисTransportStorageType") Тогда
		Если      value = ПредопределенноеЗначение("Перечисление.ВетисTransportStorageType.Замороженные") Тогда
			Возврат ВетисКонстанты.TransportationStorageType_FROZEN();
		ИначеЕсли value = ПредопределенноеЗначение("Перечисление.ВетисTransportStorageType.Охлажденные") Тогда
			Возврат ВетисКонстанты.TransportationStorageType_CHILLED();
		ИначеЕсли value = ПредопределенноеЗначение("Перечисление.ВетисTransportStorageType.Охлаждаемые") Тогда
			Возврат ВетисКонстанты.TransportationStorageType_COOLED();
		ИначеЕсли value = ПредопределенноеЗначение("Перечисление.ВетисTransportStorageType.Вентилируемые") Тогда
			Возврат ВетисКонстанты.TransportationStorageType_VENTILATED();
		Иначе
			Возврат ВетисКонстанты.TransportationStorageType_FROZEN();
		КонецЕсли;
	Иначе
		Если      value = ВетисКонстанты.TransportationStorageType_FROZEN() Тогда
			Возврат ПредопределенноеЗначение("Перечисление.ВетисTransportStorageType.Замороженные");
		ИначеЕсли value = ВетисКонстанты.TransportationStorageType_CHILLED() Тогда
			Возврат ПредопределенноеЗначение("Перечисление.ВетисTransportStorageType.Охлажденные");
		ИначеЕсли value = ВетисКонстанты.TransportationStorageType_COOLED() Тогда
			Возврат ПредопределенноеЗначение("Перечисление.ВетисTransportStorageType.Охлаждаемые");
		ИначеЕсли value = ВетисКонстанты.TransportationStorageType_VENTILATED() Тогда
			Возврат ПредопределенноеЗначение("Перечисление.ВетисTransportStorageType.Вентилируемые");
		Иначе
			Возврат ПредопределенноеЗначение("Перечисление.ВетисTransportStorageType.Замороженные");
		КонецЕсли;
	КонецЕсли;
	
КонецФункции

Функция WaybillType(value) Экспорт
	
	Если ТипЗнч(value) = Тип("ПеречислениеСсылка.ВетисWaybillType") Тогда
		Если      value = ПредопределенноеЗначение("Перечисление.ВетисWaybillType.ТовароТранспортнаяНакладная") Тогда
			Возврат ВетисКонстанты.WaybillType_ТоварноТранспортнаяНакладная();
		ИначеЕсли value = ПредопределенноеЗначение("Перечисление.ВетисWaybillType.Коносамент") Тогда
			Возврат ВетисКонстанты.WaybillType_Коносамент();
		ИначеЕсли value = ПредопределенноеЗначение("Перечисление.ВетисWaybillType.CMR") Тогда
			Возврат ВетисКонстанты.WaybillType_CMR();
		ИначеЕсли value = ПредопределенноеЗначение("Перечисление.ВетисWaybillType.Авианакладная") Тогда
			Возврат ВетисКонстанты.WaybillType_Авианакладная();
		Иначе
			Возврат ВетисКонстанты.WaybillType_ТоварноТранспортнаяНакладная();
		КонецЕсли;
	Иначе
		Если      value = ВетисКонстанты.WaybillType_ТоварноТранспортнаяНакладная() Тогда
			Возврат ПредопределенноеЗначение("Перечисление.ВетисWaybillType.ТовароТранспортнаяНакладная");
		ИначеЕсли value = ВетисКонстанты.WaybillType_Коносамент() Тогда
			Возврат ПредопределенноеЗначение("Перечисление.ВетисWaybillType.Коносамент");
		ИначеЕсли value = ВетисКонстанты.WaybillType_CMR() Тогда
			Возврат ПредопределенноеЗначение("Перечисление.ВетисWaybillType.CMR");
		ИначеЕсли value = ВетисКонстанты.WaybillType_Авианакладная() Тогда
			Возврат ПредопределенноеЗначение("Перечисление.ВетисWaybillType.Авианакладная");
		Иначе
			Возврат ПредопределенноеЗначение("Перечисление.ВетисWaybillType.ТовароТранспортнаяНакладная");
		КонецЕсли;
	КонецЕсли;
	
КонецФункции

Функция TransportInfo(value) Экспорт
	
	Если ТипЗнч(value) = Тип(ВетисИмяСправочника.Transport("СправочникСсылка")) Тогда
		
		_transportType = ВетисArgusShipmentСлой1с.TransportType(value.ТипТранспорта);
		
		_transportNumber = ВетисArgusShipment.TransportNumber();
		
		Если _transportType = ВетисКонстанты.TransportType_Автомобильный() Тогда
			_transportNumber.vehicleNumber = value.ГосударственныйНомер;
			_transportNumber.trailerNumber = value.ГосударственныйНомерПрицепа;
		Иначе
			_transportNumber.vehicleNumber = value.ГосударственныйНомер;
		КонецЕсли;
		
		_Объект = ВетисArgusShipment.TransportInfo(_transportType, _transportNumber);
		
	Иначе
		
		_ТипТранспорта = ВетисArgusShipmentСлой1с.TransportType(value.transportType);
		
		Запрос = Новый Запрос;
		Запрос.Текст =
		"ВЫБРАТЬ ПЕРВЫЕ 1
		|	_Таблица.Ссылка
		|ИЗ
		|	Справочник."+ВетисИмяСправочника.Transport()+" КАК _Таблица
		|ГДЕ
		|	НЕ _Таблица.ПометкаУдаления
		|	И ВЫБОР
		|			КОГДА _Таблица.ТипТранспорта = ЗНАЧЕНИЕ(Перечисление.ВетисTransportType.ПустаяСсылка)
		|				ТОГДА ЗНАЧЕНИЕ(Перечисление.ВетисTransportType.Автомобильный) = &ТипТранспорта
		|			ИНАЧЕ _Таблица.ТипТранспорта = &ТипТранспорта
		|		КОНЕЦ
		|	И _Таблица.ГосударственныйНомер = &Номер
		//|//онп	И _Таблица.ГосударственныйНомерПрицепа = &НомерПрицепа
		|	И ИСТИНА";
		
		Запрос.УстановитьПараметр("Номер", value.transportNumber.vehicleNumber);
		Запрос.УстановитьПараметр("НомерПрицепа", value.transportNumber.trailerNumber);
		Запрос.УстановитьПараметр("ТипТранспорта", _ТипТранспорта);
		
		//Если ЗначениеЗаполнено(value.transportNumber.trailerNumber) Тогда
		//	Запрос.Текст = СтрЗаменить(Запрос.Текст, "//онп", "");
		//КонецЕсли;
		
		Результат = Запрос.Выполнить();
		Выборка = Результат.Выбрать();
		
		Если Выборка.Следующий() Тогда
			_Объект = Выборка.Ссылка;
		Иначе
			_Объект = ПредопределенноеЗначение(ВетисИмяСправочника.Transport("Справочник","ПустаяСсылка"));
		КонецЕсли;
		
	КонецЕсли;
	
	Возврат _Объект;
	
КонецФункции

Функция WaybillКонвертировать(пСтрокаТТН, пДата, пВозврат = Ложь) Экспорт
	
	_Версия20 = ВетисОбщегоНазначения.ВерсияРавно("2.0");
	_ВетисArgusShipment = ?(_Версия20, ВетисDictionary_2_0, ВетисArgusShipment);
	_ВетисArgusShipmentСлой1с = ?(_Версия20, ВетисDictionaryСлой1с, ВетисArgusShipmentСлой1с);
	_ВетисCerberusEnterprise = ?(_Версия20, ВетисDictionary_2_0, ВетисCerberusEnterprise);
	_ВетисCerberusEnterpriseСлой1с = ?(_Версия20, ВетисDictionaryСлой1с, ВетисCerberusEnterpriseСлой1с);
	
	_СтрокаТТН = пСтрокаТТН;
	
	_waybill = _ВетисArgusShipment.Waybill();
	_waybill.issueSeries   = _СтрокаТТН.Серия;
	_waybill.issueNumber   = _СтрокаТТН.Номер;
	_waybill.issueDate     = ВетисОбщегоНазначения.ВремяВетис(_СтрокаТТН.Дата);
	_waybill.type          = _ВетисArgusShipmentСлой1с.WaybillType(_СтрокаТТН.Тип);
	_waybill.broker        = _ВетисCerberusEnterprise.BusinessEntity(_ВетисCerberusEnterpriseСлой1с.BusinessEntity(_СтрокаТТН.Посредник));
	_waybill.transportInfo = _ВетисArgusShipmentСлой1с.TransportInfo(_СтрокаТТН.Транспорт);
	_waybill.transportStorageType = _ВетисArgusShipmentСлой1с.TransportationStorageType(_СтрокаТТН.СпособХранения);
	
	Если пВозврат = Истина Тогда
		_waybill.issueSeries   = "";
		_waybill.issueNumber   = "";
		_waybill.issueDate     = ВетисОбщегоНазначения.ВремяВетис(пДата);
	КонецЕсли;
	
	Возврат _waybill;
	
КонецФункции
