
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Если Параметры.Свойство("Guid") Тогда
		Guid = Параметры.Guid;
	КонецЕсли;
	
	Если Параметры.Свойство("НоменклатурнаяГруппа") Тогда
		НоменклатурнаяГруппа = Параметры.НоменклатурнаяГруппа;
	КонецЕсли;
	
	Если ЗначениеЗаполнено(Guid) И НЕ ЗначениеЗаполнено(НоменклатурнаяГруппа) Тогда
		НоменклатурнаяГруппа = Ветис.Соответствие_ПолучитьСсылку(Guid, ВетисИмяСправочника.ProductItem("Справочник"));
		ЕстьСвязь = ЗначениеЗаполнено(НоменклатурнаяГруппа);
	ИначеЕсли НЕ ЗначениеЗаполнено(Guid) И ЗначениеЗаполнено(НоменклатурнаяГруппа) Тогда
		Guid = Ветис.Соответствие_ПолучитьGuid(НоменклатурнаяГруппа);
		ЕстьСвязь = ЗначениеЗаполнено(Guid);
	Иначе
		ЕстьСвязь = Guid = Ветис.Соответствие_ПолучитьGuid(НоменклатурнаяГруппа);
	КонецЕсли;
	
	Элементы.ДекорацияЕстьСвязь1.Видимость = ЕстьСвязь;
	Элементы.ДекорацияЕстьСвязь0.Видимость = НЕ ЕстьСвязь;
	
	КомандаНайтиПоGuidСервер();
	
КонецПроцедуры

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	
КонецПроцедуры

&НаКлиенте
Процедура ОбработкаОповещения(ИмяСобытия, Параметр, Источник)
	
КонецПроцедуры


&НаКлиенте
Процедура КомандаГотово(Команда)
	
	Закрыть(НоменклатурнаяГруппа);
	
КонецПроцедуры

&НаКлиенте
Процедура КомандаНайти(Команда)
	
	КомандаНайтиПоGuidСервер();
	
КонецПроцедуры

&НаКлиенте
Процедура КомандаДобавить(Команда)
	
	_оо = Новый ОписаниеОповещения("КомандаДобавитьОбработкаОповещения", ЭтаФорма);
	
	_форма = ОткрытьФорму(ВетисИмяСправочника.ProductItem("Справочник", "ФормаОбъекта"),,,,,,_оо);
	
	ЗаполнитьЗначенияСвойств(_форма.Объект, ЭтаФорма);
	
КонецПроцедуры

&НаКлиенте
Процедура КомандаДобавитьОбработкаОповещения(пРезультат, пПараметры) Экспорт
	
	Если НЕ пРезультат = Неопределено Тогда
		
		НоменклатурнаяГруппа = пРезультат;
		
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ДекорацияЕстьСвязь1Нажатие(Элемент)
	
	ВетисВызовСервера.Соответствие_Удалить(НоменклатурнаяГруппа);
	
	ЕстьСвязь = Ложь;
	
	Элементы.ДекорацияЕстьСвязь1.Видимость = ЕстьСвязь;
	Элементы.ДекорацияЕстьСвязь0.Видимость = НЕ ЕстьСвязь;
	
КонецПроцедуры

&НаКлиенте
Процедура ДекорацияЕстьСвязь0Нажатие(Элемент)
	
	ВетисВызовСервера.Соответствие_Добавить(НоменклатурнаяГруппа, Guid, Наименование);
	
	ЕстьСвязь = Истина;
	
	Элементы.ДекорацияЕстьСвязь1.Видимость = ЕстьСвязь;
	Элементы.ДекорацияЕстьСвязь0.Видимость = НЕ ЕстьСвязь;
	
КонецПроцедуры


&НаКлиенте
Процедура GuidПриИзменении(Элемент)
	
	ЕстьСвязь = Guid = ВетисВызовСервера.Соответствие_ПолучитьGuid(НоменклатурнаяГруппа);
	
	Элементы.ДекорацияЕстьСвязь1.Видимость = ЕстьСвязь;
	Элементы.ДекорацияЕстьСвязь0.Видимость = НЕ ЕстьСвязь;
	
КонецПроцедуры

&НаКлиенте
Процедура НоменклатурнаяГруппаПриИзменении(Элемент)
	
	ЕстьСвязь = Guid = ВетисВызовСервера.Соответствие_ПолучитьGuid(НоменклатурнаяГруппа);
	
	Элементы.ДекорацияЕстьСвязь1.Видимость = ЕстьСвязь;
	Элементы.ДекорацияЕстьСвязь0.Видимость = НЕ ЕстьСвязь;
	
КонецПроцедуры


&НаСервере
Процедура КомандаНайтиПоGuidСервер()
	
	Если ЗначениеЗаполнено(Guid) Тогда
		
		_Версия20 = Ветис.Версия_2_0();
		
		_subProduct = ?(_Версия20, ВетисProductService, ВетисProductService_2_0).GetSubProductByGuid(Guid);
		_product = ?(_Версия20, ВетисProductService, ВетисProductService_2_0).GetProductByGuid(_subProduct.productguid);
		
		Наименование = _subProduct.name;
		
		productType = ?(_Версия20, ВетисArgusProductionСлой1с, ВетисDictionaryСлой1с).ProductType(_product.productType);
		product = _product.name;
		
	Иначе
		productType = Неопределено;
		product = "";
		Наименование = "";
	КонецЕсли;
	
КонецПроцедуры
