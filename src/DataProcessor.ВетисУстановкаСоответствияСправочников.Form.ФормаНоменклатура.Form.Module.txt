
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	ТипПродукции = ПредопределенноеЗначение("Перечисление.ВетисProductType.МясоИМясопродукты");
	
КонецПроцедуры

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	
КонецПроцедуры

&НаКлиенте
Процедура ВетисНоменклатураЗаполнить(Команда)
	
	ВетисНоменклатураЗаполнитьСервер();
	
КонецПроцедуры

&НаСервере
Процедура ВетисНоменклатураЗаполнитьСервер()
	
	Перем _product, _subProduct, _productItem, _параметрыP;
	
	_Версия20 = ВетисXSD.Версия_2_0();
	_ВетисProductService = ?(_Версия20, ВетисProductService_2_0, ВетисProductService);
	//_ВетисEnterpriseService = ?(_Версия20, ВетисEnterpriseService_2_0, ВетисEnterpriseService);
	_ВетисArgusProductionСлой1с = ?(_Версия20, ВетисDictionaryСлой1с, ВетисArgusProductionСлой1с);
	_ВетисCerberusEnterpriseСлой1с = ?(_Версия20, ВетисDictionaryСлой1с, ВетисCerberusEnterpriseСлой1с);
	_ВетисCerberusEnterprise = ?(_Версия20, ВетисDictionary_2_0, ВетисCerberusEnterprise);
	
	_issuerId = _ВетисCerberusEnterpriseСлой1с.BusinessEntity(Объект.ХозяйствующийСубъект);
	
	//_businessEntity = _ВетисEnterpriseService.GetBusinessEntityByGuid(_issuerId);
	
	_businessEntity = _ВетисCerberusEnterprise.BusinessEntity(_issuerId);
	
	_enterpriseGuid = _ВетисCerberusEnterpriseСлой1с.Enterprise(Объект.Предприятие);
	
	_enterprise = _ВетисCerberusEnterprise.Enterprise(_enterpriseGuid);
	
	_ТипПродукции = _ВетисArgusProductionСлой1с.ProductType(ТипПродукции);
	
	СписокВетис.Очистить();
	
	Пока _ВетисProductService.GetProductByTypeListСледующий(_ТипПродукции, _product, _параметрыP) Цикл
		
		_параметрыS = Неопределено;
		Пока _ВетисProductService.GetSubProductByProductListСледующий(_product.guid, _subProduct, _параметрыS) Цикл
			
			_СписокСтрока = СписокSubProductВетис.Добавить();
			_СписокСтрока.name = _subProduct.name;
			_СписокСтрока.guid = _subProduct.guid;
			
			_параметрыPI = Неопределено;
			Если _Версия20 Тогда
				Пока ВетисProductService_2_0.GetProductItemListСледующий(_ТипПродукции, _product, _subProduct, _businessEntity, _enterprise, _productItem, _параметрыPI) Цикл
					
					_СписокСтрока = СписокВетис.Добавить();
					_СписокСтрока.name = _productItem.name;
					_СписокСтрока.guid = _productItem.guid;
					_СписокСтрока.subProduct = _subProduct.guid;
					
				КонецЦикла;
			Иначе
				Пока ВетисProductService.GetProductItemListСледующий(_subProduct.guid, _enterpriseGuid, _productItem, _параметрыPI) Цикл
					
					_СписокСтрока = СписокВетис.Добавить();
					_СписокСтрока.name = _productItem.name;
					_СписокСтрока.guid = _productItem.guid;
					_СписокСтрока.subProduct = _subProduct.guid;
					
				КонецЦикла;
			КонецЕсли;
			
		КонецЦикла;
		
	КонецЦикла;
	
	СписокВетис.Сортировать("name");
		
КонецПроцедуры


&НаКлиенте
Процедура СоздатьСвязь(Команда)
	
	СоздатьСвязьСервер();
	
	Элементы.СправочникСписок.Обновить();
	
КонецПроцедуры

&НаСервере
Процедура СоздатьСвязьСервер() Экспорт
	
	ТекДанные = Объект.ВетисНоменклатура.НайтиПоИдентификатору(Элементы.ВетисНоменклатура.ТекущаяСтрока);
	
	_ТипПродукции = Перечисления.ВетисProductType.Индекс(ТипПродукции) + 1;
	
	Если Элементы.СправочникСписок.ВыделенныеСтроки.Количество() > 0 Тогда
		Для Каждого ТекДанные1с из Элементы.СправочникСписок.ВыделенныеСтроки Цикл
			
		КонецЦикла;
	Иначе
		ТекДанные1с = Элементы.СправочникСписок.ТекущиеДанные;
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура УдалитьСвязь(Команда)
	
	УдалитьСвязьСервер();
	
	Элементы.СправочникСписок.Обновить();
	
КонецПроцедуры

&НаСервере
Процедура УдалитьСвязьСервер()
	
	Если Элементы.СправочникСписок.ВыделенныеСтроки.Количество() > 0 Тогда
		Для Каждого ТекДанные из Элементы.СправочникСписок.ВыделенныеСтроки Цикл
			
		КонецЦикла;
	Иначе
		ТекДанные = Элементы.СправочникСписок.ТекущиеДанные;
		
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ВетисНоменклатураВыбор(Элемент, ВыбраннаяСтрока, Поле, СтандартнаяОбработка)
	
	ТекДанные = Элементы.ВетисНоменклатура.ТекущиеДанные;
	
	Если ТекДанные = Неопределено Тогда Возврат; КонецЕсли;
	
	ВетисОбщегоНазначения.ДобавитьОтбор(СправочникСписок.Отбор, "Наименование", ТекДанные.Наименование);
	
КонецПроцедуры

&НаКлиенте
Процедура ХСНачалоВыбора(Элемент, ДанныеВыбора, СтандартнаяОбработка)
	
	ВетисФормы.BusinessEntityФормаВыбора(ЭтаФорма, "ХСОбработкаОповещения", СтандартнаяОбработка, Объект.ХозяйствующийСубъект);
	
КонецПроцедуры

&НаКлиенте
Процедура ХСОбработкаОповещения(Результат, Параметр) Экспорт
	
	Если НЕ Результат = Неопределено Тогда
		Объект.ХозяйствующийСубъект = Результат;
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ПредприятиеНачалоВыбора(Элемент, ДанныеВыбора, СтандартнаяОбработка)
	
	ВетисФормы.EnterpriseФормаВыбора(ЭтаФорма, "ПредприятиеОбработкаОповещения", СтандартнаяОбработка, Объект.ХозяйствующийСубъект);
	
КонецПроцедуры

&НаКлиенте
Процедура ПредприятиеОбработкаОповещения(Результат, Параметр) Экспорт
	
	Если НЕ Результат = Неопределено Тогда
		Объект.Предприятие = Результат;
	КонецЕсли;
	
КонецПроцедуры
