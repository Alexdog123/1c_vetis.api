
// предназначена для получения последней в истории записи хозяйствующего субъекта
Функция GetBusinessEntityByGuid(guid, ПоУмолчанию = Неопределено) Экспорт
	
	Попытка
		Возврат Прокси().GetBusinessEntityByGuid(guid);
	Исключение
		ВетисЖурнал.ДобавитьИнформациюОбОшибке(ИнформацияОбОшибке());
		ВызватьИсключение;
	КонецПопытки;
	
КонецФункции

// предназначена для получения последней в истории записи предприятия
Функция GetEnterpriseByGuid(guid, ПоУмолчанию = Неопределено) Экспорт
	
	Попытка
		Возврат Прокси().GetEnterpriseByGuid(guid);
	Исключение
		ВетисЖурнал.ДобавитьИнформациюОбОшибке(ИнформацияОбОшибке());
		ВызватьИсключение;
	КонецПопытки;
	
КонецФункции


// предназначена для получения списка хозяйствующих субъектов из реестра Россельхознадзора.
//  пfiltr - Структура - отбор
//  пListOptions - возвращаемый
Функция GetBusinessEntityList(пfiltr = Неопределено, пListOptions = Неопределено) Экспорт
	
	Если пListOptions = Неопределено Тогда
		пListOptions = ВетисBase.ListOptions();
	Иначе
		пListOptions.offset = пListOptions.offset + пListOptions.count;
	КонецЕсли;
	
	Если пfiltr = Неопределено Тогда
		Возврат Прокси().GetBusinessEntityList(пListOptions);
	Иначе
		Возврат Прокси().GetBusinessEntityList(пListOptions, ВетисCerberusEnterprise.BusinessEntity(пfiltr));
	КонецЕсли;
	
КонецФункции

// Предназначена для выборки хозяйствующих субъектов из реестра Россельхознадзора.
// Используется самостоятельно в цикле Пока.
// Параметры:
//  filtr - Структура - отбор
//  пItem - элемент списка, возвращаемый параметр
//  пПараметры - для внутреннего использования, начальное значение - Неопределено
// Возвращаемое значение:
//	Булево - Ложь значит список пройден весь
Функция GetBusinessEntityListСледующий(пfiltr = Неопределено, пItem, пПараметры) Экспорт
	
	Если пПараметры = Неопределено Тогда
		пПараметры = Новый Структура;
		пПараметры.Вставить("ListOptions", ВетисBase.ListOptions());
		пПараметры.Вставить("Индекс", 0);
	Иначе
		пПараметры.Индекс = пПараметры.Индекс + 1;
		Если пПараметры.Индекс >= пПараметры.ListResponse.count Тогда
			Если пПараметры.ListOptions.offset + пПараметры.ListOptions.count >= Число(пПараметры.ListResponse.Total) Тогда
				Возврат Ложь;
			Иначе
				пПараметры.ListOptions.offset = пПараметры.ListOptions.offset + пПараметры.ListOptions.count;
				пПараметры.Индекс = 0;
			КонецЕсли;
		Иначе
			пItem = пПараметры.ListResponse.businessEntity[пПараметры.Индекс];
			Возврат Истина;
		КонецЕсли;
	КонецЕсли;
	
	Попытка
		Если пfiltr = Неопределено Тогда
			_List = Прокси().GetBusinessEntityList(пПараметры.ListOptions);
		Иначе
			_List = Прокси().GetBusinessEntityList(пПараметры.ListOptions, ВетисCerberusEnterprise.BusinessEntity(пfiltr));
		КонецЕсли;
	Исключение
		ВетисЖурнал.ДобавитьИнформациюОбОшибке(ИнформацияОбОшибке());
		ВызватьИсключение;
	КонецПопытки;
	
	пПараметры.Вставить("ListResponse", _List);
	
	Если пПараметры.Индекс >= пПараметры.ListResponse.count Тогда
		Возврат Ложь;
	Иначе
		пItem = пПараметры.ListResponse.businessEntity[пПараметры.Индекс];
		Возврат Истина;
	КонецЕсли;
	
КонецФункции


// предназначена для получения списка предприятий, зарегистрированных на территории Российской Федерации.
// Параметры:
//  пfiltr - Структура - отбор
//  пListOptions - возвращаемый
Функция GetRussianEnterpriseList(пfiltr = Неопределено, пListOptions = Неопределено) Экспорт
	
	Если пListOptions = Неопределено Тогда
		пListOptions = ВетисBase.ListOptions();
	Иначе
		пListOptions.offset = пListOptions.offset + пListOptions.count;
	КонецЕсли;
	
	Попытка
		Если пfiltr = Неопределено Тогда
			Возврат Прокси().GetRussianEnterpriseList(пListOptions);
		Иначе
			Возврат Прокси().GetRussianEnterpriseList(пListOptions, ВетисCerberusEnterprise.Enterprise(пfiltr));
		КонецЕсли;
	Исключение
		ВетисЖурнал.ДобавитьИнформациюОбОшибке(ИнформацияОбОшибке());
		ВызватьИсключение;
	КонецПопытки;
	
КонецФункции

// Предназначена для выборки предприятий, зарегистрированных на территории Российской Федерации.
// Используется самостоятельно в цикле Пока.
// Параметры:
//  пfiltr - Структура - отбор
//  пItem - элемент списка, возвращаемый параметр
//  пПараметры - для внутреннего использования, начальное значение - Неопределено
// Возвращаемое значение:
//	Булево - Ложь значит список пройден весь
Функция GetRussianEnterpriseListСледующий(пfiltr = Неопределено, пItem, пПараметры) Экспорт
	
	Если пПараметры = Неопределено Тогда
		пПараметры = Новый Структура;
		пПараметры.Вставить("ListOptions", ВетисBase.ListOptions());
		пПараметры.Вставить("Индекс", 0);
	Иначе
		пПараметры.Индекс = пПараметры.Индекс + 1;
		Если пПараметры.Индекс >= пПараметры.ListResponse.count Тогда
			Если пПараметры.ListOptions.offset + пПараметры.ListOptions.count >= Число(пПараметры.ListResponse.Total) Тогда
				Возврат Ложь;
			Иначе
				пПараметры.ListOptions.offset = пПараметры.ListOptions.offset + пПараметры.ListOptions.count;
				пПараметры.Индекс = 0;
			КонецЕсли;
		Иначе
			пItem = пПараметры.ListResponse.enterprise[пПараметры.Индекс];
			Возврат Истина;
		КонецЕсли;
	КонецЕсли;
	
	Попытка
		Если пfiltr = Неопределено Тогда
			_ListResponse = Прокси().GetRussianEnterpriseList(пПараметры.ListOptions);
		Иначе
			_ListResponse = Прокси().GetRussianEnterpriseList(пПараметры.ListOptions, ВетисCerberusEnterprise.Enterprise(пfiltr));
		КонецЕсли;
	Исключение
		ВетисЖурнал.ДобавитьИнформациюОбОшибке(ИнформацияОбОшибке());
		ВызватьИсключение;
	КонецПопытки;
	
	пПараметры.Вставить("ListResponse", _ListResponse);
	
	Если пПараметры.Индекс >= пПараметры.ListResponse.count Тогда
		Возврат Ложь;
	Иначе
		пItem = пПараметры.ListResponse.enterprise[пПараметры.Индекс];
		Возврат Истина;
	КонецЕсли;
	
	Возврат Истина;
	
КонецФункции


// Предназначена для выборки предприятий, подчиненных ХС.
// Этой функции нет в сервисе, название выдуманное
// Используется самостоятельно в цикле Пока.
// Параметры:
//  пGuid - Структура - guid ХС
//  пItem - элемент списка, возвращаемый параметр
//  пПараметры - для внутреннего использования, начальное значение - Неопределено
// Возвращаемое значение:
//	Булево - Ложь значит список пройден весь
Функция GetBusinessEntityEnterpriseListСледующий(пGuid, пItem, пПараметры) Экспорт
	
	Если пПараметры = Неопределено Тогда
		пПараметры = Новый Структура;
		пПараметры.Вставить("List", Новый Массив);
		пПараметры.Вставить("Индекс", 0);
		Попытка
			_Entity = GetBusinessEntityByGuid(пGuid);
			Для Каждого _Location из _Entity.activityLocation Цикл
				_Enterprise = GetEnterpriseByGuid(_Location.enterprise.guid);
				пПараметры.List.Добавить(_Enterprise);
			КонецЦикла;
		Исключение
			ВетисЖурнал.ДобавитьИнформациюОбОшибке(ИнформацияОбОшибке());
			ВызватьИсключение;
		КонецПопытки;
	Иначе
		пПараметры.Индекс = пПараметры.Индекс + 1;
	КонецЕсли;
	
	Если пПараметры.Индекс >= пПараметры.List.Количество() Тогда
		Возврат Ложь;
	Иначе
		пItem = пПараметры.List[пПараметры.Индекс];
		Возврат Истина;
	КонецЕсли;
	
КонецФункции


Функция Прокси()
	
	_Прокси = ВетисXSD.Прокси("EnterpriseService", Перечисления.ВетисВерсияAPI.v2_0);
	
	Возврат _Прокси;
	
КонецФункции
