
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
КонецПроцедуры


&НаКлиенте
Процедура КомандаСписокВетисЗаполнить(Команда)
	
	СтраныВетисЗаполнитьСервер();
	
КонецПроцедуры

&НаКлиенте
Процедура КомандаСоздатьСвязь(Команда)
	
	СоздатьСвязьСервер(Элементы.СправочникСписок.ТекущиеДанные.Ссылка, Элементы.СправочникСписок.ТекущиеДанные.name);
	
	Элементы.СправочникСписок.Обновить();
	
КонецПроцедуры

&НаКлиенте
Процедура КомандаУдалитьСвязь(Команда)
	
	УдалитьСвязьСервер();
	
	Элементы.СправочникСписок.Обновить();
	
КонецПроцедуры


&НаСервере
Процедура СтраныВетисЗаполнитьСервер()
	
	Перем _Entity, _Параметры;
	
	_Версия20 = ВетисXSD.Версия_2_0();
	_ВетисIkarService = ?(_Версия20, ВетисIkarService_2_0, ВетисIkarService);
	
	СписокВетис.Очистить();
	
	Пока _ВетисIkarService.GetAllCountryListСледующий(_Entity, _Параметры) Цикл
		
		_Строка = СписокВетис.Добавить();
		
		ЗаполнитьЗначенияСвойств(_Строка, _Entity);
		
	КонецЦикла;
	
КонецПроцедуры

&НаСервере
Процедура СоздатьСвязьСервер(пСсылка, name) Экспорт
	
	Если ЭтаФорма.ТекущийЭлемент = Элементы.СписокВетис Тогда
		_ТекДанные = СписокВетис.НайтиПоИдентификатору(Элементы.СписокВетис.ТекущаяСтрока);
	Иначе
		_СтраныВетисСтроки = СписокВетис.НайтиСтроки(Новый Структура("name", name));
		
		Если _СтраныВетисСтроки.Количество() = 0 Тогда Возврат; КонецЕсли;
		
		_ТекДанные = _СтраныВетисСтроки[0];
		
	КонецЕсли;
	
	
	Если Элементы.СправочникСписок.ВыделенныеСтроки.Количество() > 0 Тогда
		
		Для Каждого _ТекДанные1с из Элементы.СправочникСписок.ВыделенныеСтроки Цикл
			ВетисСоответствие.Добавить(пСсылка, _ТекДанные.guid, _ТекДанные.name);
		КонецЦикла;
		
	Иначе
		ВетисСоответствие.Добавить(пСсылка, _ТекДанные.guid, _ТекДанные.name);
		
	КонецЕсли;
	
КонецПроцедуры

&НаСервере
Процедура УдалитьСвязьСервер()
	
	Если Элементы.СправочникСписок.ВыделенныеСтроки.Количество() > 0 Тогда
		Для Каждого _ТекДанные из Элементы.СправочникСписок.ВыделенныеСтроки Цикл
			
			ВетисСоответствие.Удалить(_ТекДанные.Ссылка);
			
		КонецЦикла;
	Иначе
		_ТекДанные = Элементы.СправочникСписок.ТекущиеДанные;
		
		ВетисСоответствие.Удалить(_ТекДанные.Ссылка);
		
	КонецЕсли;
	
КонецПроцедуры


&НаКлиенте
Процедура СписокВетисВыбор(Элемент, ВыбраннаяСтрока, Поле, СтандартнаяОбработка)
	
	_ТекДанные = Элементы.СписокВетис.ТекущиеДанные;
	
	Элементы.СправочникСписок.ТекущаяСтрока = СправочникСписокНайти(_ТекДанные.name)
	
КонецПроцедуры

&НаСервере
Функция СправочникСписокНайти(пНаименование)
	
	Возврат Справочники[ВетисИмяСправочника.Country()].НайтиПоНаименованию(пНаименование);
	
КонецФункции


&НаКлиенте
Процедура СправочникСписокВыбор(Элемент, ВыбраннаяСтрока, Поле, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	
	_ТекДанные = Элементы.СправочникСписок.ТекущиеДанные;
	
	_СтраныВетисСтроки = СписокВетис.НайтиСтроки(Новый Структура("name", _ТекДанные.name));
	
	Если _СтраныВетисСтроки.Количество() = 0 Тогда
		Возврат;
	КонецЕсли;
	
	Элементы.СписокВетис.ТекущаяСтрока = _СтраныВетисСтроки[0].ПолучитьИдентификатор();
	
КонецПроцедуры


